// Main JavaScript for Eduplus School and College Website

document.addEventListener('DOMContentLoaded', function() {
    // Initialize Bootstrap tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    // Hero Slider
    initializeHeroSlider();

    // News Carousel
    initializeNewsCarousel();

    // Gallery Lightbox
    initializeGalleryLightbox();

    initializeClock();

    // Dynamic Year for Copyright
    if (document.getElementById('current-year')) {
        document.getElementById('current-year').textContent = new Date().getFullYear();
    }

    // Form Validation
    initializeFormValidation();
});

// Hero Slider Functionality
function initializeHeroSlider() {
    const sliderElement = document.querySelector('.hero-slider');
    if (!sliderElement) return;

    // Get all slides
    const slides = sliderElement.querySelectorAll('.hero-slide');
    if (slides.length === 0) return;

    let currentSlide = 0;
    
    // Show the first slide
    slides[0].style.display = 'block';
    
    // Change slide every 5 seconds
    setInterval(() => {
        // Hide current slide
        slides[currentSlide].style.display = 'none';
        
        // Move to next slide
        currentSlide = (currentSlide + 1) % slides.length;
        
        // Show the next slide
        slides[currentSlide].style.display = 'block';
        
        // Add fade-in animation
        slides[currentSlide].classList.add('fade-in');
        
        // Remove animation class after animation completes
        setTimeout(() => {
            slides[currentSlide].classList.remove('fade-in');
        }, 1000);
    }, 5000);
}

// News Carousel Functionality
function initializeNewsCarousel() {
    const newsCarousel = document.querySelector('.news-carousel');
    if (!newsCarousel) return;

    // This is a placeholder for a carousel implementation
    // In production, consider using a library or more advanced carousel
    const newsItems = newsCarousel.querySelectorAll('.news-item');
    if (newsItems.length <= 3) return; // No need for carousel if 3 or fewer items

    // Simple next/prev functionality
    const nextBtn = newsCarousel.querySelector('.carousel-next');
    const prevBtn = newsCarousel.querySelector('.carousel-prev');
    
    if (nextBtn && prevBtn) {
        let currentIndex = 0;
        
        nextBtn.addEventListener('click', () => {
            if (currentIndex < newsItems.length - 3) {
                currentIndex++;
                updateCarouselPosition();
            }
        });
        
        prevBtn.addEventListener('click', () => {
            if (currentIndex > 0) {
                currentIndex--;
                updateCarouselPosition();
            }
        });
        
        function updateCarouselPosition() {
            const itemWidth = newsItems[0].offsetWidth + 20; // Width + margin
            newsCarousel.querySelector('.news-carousel-inner').style.transform = 
                `translateX(-${currentIndex * itemWidth}px)`;
        }
    }
}

// Gallery Lightbox Functionality
function initializeGalleryLightbox() {
    const galleryItems = document.querySelectorAll('.gallery-item');
    if (galleryItems.length === 0) return;

    galleryItems.forEach(item => {
        item.addEventListener('click', function() {
            const imgSrc = this.querySelector('img').src;
            const imgCaption = this.querySelector('.gallery-caption')?.textContent || '';
            
            // Create lightbox elements
            const lightbox = document.createElement('div');
            lightbox.className = 'lightbox';
            
            lightbox.innerHTML = `
                <div class="lightbox-content">
                    <img src="${imgSrc}" alt="${imgCaption}">
                    <div class="lightbox-caption">${imgCaption}</div>
                    <button class="lightbox-close">&times;</button>
                </div>
            `;
            
            // Add to body
            document.body.appendChild(lightbox);
            document.body.style.overflow = 'hidden';
            
            // Close lightbox on click
            lightbox.addEventListener('click', function(e) {
                if (e.target === lightbox || e.target.className === 'lightbox-close') {
                    document.body.removeChild(lightbox);
                    document.body.style.overflow = '';
                }
            });
        });
    });
}

// Form Validation
function initializeFormValidation() {
    const forms = document.querySelectorAll('.needs-validation');
    
    Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            form.classList.add('was-validated');
        }, false);
    });
}

// Notice Filter Functionality
function filterNotices() {
    const category = document.getElementById('notice-category').value;
    const searchTerm = document.getElementById('notice-search').value.toLowerCase();
    const notices = document.querySelectorAll('.notice-item');
    
    notices.forEach(notice => {
        const noticeCategory = notice.getAttribute('data-category');
        const noticeTitle = notice.querySelector('.notice-title').textContent.toLowerCase();
        const noticeContent = notice.querySelector('.notice-content').textContent.toLowerCase();
        
        // Check if notice matches both category and search term
        const categoryMatch = category === 'all' || noticeCategory === category;
        const searchMatch = noticeTitle.includes(searchTerm) || noticeContent.includes(searchTerm);
        
        // Show/hide based on filters
        if (categoryMatch && searchMatch) {
            notice.style.display = 'block';
        } else {
            notice.style.display = 'none';
        }
    });
}

// Language Toggle
function toggleLanguage(lang) {
    // This is a placeholder for language switching functionality
    console.log('Switching to language: ' + lang);
    
    // In a real implementation, this would load translated content
    // or redirect to language-specific version of the site
    
    // Update active state in UI
    document.querySelectorAll('.language-toggle a').forEach(el => {
        el.classList.remove('active');
    });
    
    document.querySelector(`.language-toggle a[data-lang="${lang}"]`).classList.add('active');
}

// Portal Login Functionality
function handleLogin(event) {
    event.preventDefault();
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const userType = document.querySelector('input[name="userType"]:checked').value;
    
    // This is a placeholder for actual authentication
    // In a real implementation, this would send data to server for verification
    console.log(`Login attempt: ${username}, ${userType}`);
    
    // Simulate checking credentials
    if (username && password) {
        // Redirect to appropriate dashboard (in a real implementation)
        window.location.href = `/pages/portal/${userType}-dashboard.php`;
    } else {
        // Show error message
        document.getElementById('login-error').textContent = 'Please enter valid credentials';
        document.getElementById('login-error').style.display = 'block';
    }
}

function initializeClock()
{
    window.clock_intervel = setInterval(() => {
        let time = moment().format("dddd, MMMM D, YYYY h:mm:ss A");
        [...document.querySelectorAll('.auto-clock')].forEach((clock) => {
            clock.innerHTML = time;
        });
    }, 1000);
}